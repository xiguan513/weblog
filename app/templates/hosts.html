
<head>
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    
</head>
<script src="static/js/jquery-1.10.2.min.js"></script>
<script src="static/js/bootstrap.min.js"></script>
<script src="static/js/bootstrap-datetimepicker.js"></script>
<script src="static/js/bootstrap-datetimepicker.fr.js"></script>

<div class="wrapper">
    <div class="row">
    
        <form class="form-inline" action="/query">
          <div class="col-md-2">
          </div>
          <div class="col-md-3">
           输入主机名
            <input type="text" class="form-control" id="ip" name="ip" placeholder="192.168.1.1">
          </div>
          <div class="form-group">
            开始日期
            <input class="form_date form-control" id="starttime" size="16" type="datetime-local" value="2017-01-01T00:00" name="First Time"/>
          </div>
          <div class="form-group">
            结束日期
            <input class="form_date form-control" id="endtime" size="16" type="datetime-local" value="2017-01-01T00:00" name="Last Time"/>
          </div>
          <button type="submit" id="start" class="btn btn-default">查询</button>
            <button type="submit" id="clear" class="btn btn-default">清空</button>
        </form>
            <div class="row" style="overflow-y:hidden;overflow-x:hidden">
        <div class="col-md-1">
        </div>
        <div class="col-md-8">
            <font size="2px">
                <div id="out" style="width: 1500px; height: 400px;border: 1px #ccc solid; overflow-y: scroll;float: left;"></div>
            </font>
        </div>
    </div>
    </div>
{#    <div class="row">#}
{#        <div class="col-md-1">#}
{#        </div>#}
{#        <div class="col-md-8">#}
{#            <font size="2px">#}
{#                {% for p in ms_mi_log_data %}#}
{#                <p>ip:{{p.ip}} rc:{{p.rc}} uin:{{p.uin}} mbox:{{p.mbox}} des:{{p.des}}</p>#}
{#                {% endfor %}#}
{#            </font>#}
{#        </div>#}
{#    </div>#}
</div>

{#<script type="text/javascript">#}
{#    $('.form_date').datetimepicker({#}
{#        language:  'fr',#}
{#        weekStart: 1,#}
{#        todayBtn:  1,#}
{#        autoclose: 1,#}
{#        todayHighlight: 1,#}
{#        startView: 2,#}
{#        minView: 2,#}
{#        forceParse: 0,#}
{#        format: 'yyyy-mm-dd'#}
{#    });#}
{##}
{#</script>#}

<script>

            var t = false;
            function sse(ip,starttime,endtime) {
                var source = new EventSource('/query'+'?'+ip+'&'+'First+Time='+starttime+'&'+'Last+Time='+endtime);

                // var out = document.getElementById('out');
                source.onmessage = function(e) {
                    alert("测试1111111111111111111111111111")
                    // XSS in chat is fun
                    if(t){
                        source.close();
                        return ;
                    };
                    // out.innerHTML =  e.data + '\\n' + out.innerHTML;
                    //$("#out").append(e.data+'</br>');


                };
            }
            $('#in').keyup(function(e){
                if (e.keyCode == 13) {
                    $.post('/post', {'message': $(this).val()});
                    $(this).val('');
                }
            });



            $('#stop').click(function(){
              // action goes here!!
              t = true;
            });
            $('#start').click(function(){
              // action goes here!!
              starttime=$("#starttime").val();
              ip=$("#ip").val();
              endtime=$("#endtime").val();
              t = false;
              //console.log(logfile);
              sse(ip,starttime,endtime);
            });
            $('#clean').click(function(){
              $("#out").html("");

            });
</script>